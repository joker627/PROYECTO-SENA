{% extends 'base_admin.html' %}

{% block title %}Mi Perfil - Sign Technology{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/perfil.css') }}">
{% endblock %}

{% block content %}
<div class="profile-container">

    <!-- Profile Card -->
    <div class="profile-card">
        <div class="profile-avatar-wrapper">
            <div class="profile-avatar">
                <img src="{{ url_for('static', filename='img/profiles/' + (session.user.imagen_perfil if session.user and session.user.imagen_perfil else 'user.svg')) }}?t={{ range(1000, 99999)|random }}"
                    alt="Avatar">
            </div>
            <div class="avatar-edit">
                <img src="{{ url_for('static', filename='img/icons/camera-alt.svg') }}" alt="" width="20" height="20">
            </div>
        </div>

        <h2 class="profile-name">
            {% if session.user %}{{ session.user.nombre_completo }}{% else %}Usuario{% endif %}
        </h2>

        <div class="profile-role">
            <span class="role-badge-highlight">
                {% if session.user %}{{ session.user.nombre_rol or 'Colaborador' }}{% else %}Colaborador{% endif %}
            </span>
        </div>

        <div class="profile-stats">
            <div class="profile-stat">
                <label>Miembro desde</label>
                <span>
                    {% if session.user %}
                    {{ session.user.fecha_registro[:7] if session.user.fecha_registro else 'Enero 2026' }}
                    {% else %}
                    Enero 2026
                    {% endif %}
                </span>
            </div>
        </div>
    </div>

    <!-- Info Section -->
    <div class="info-section">
        <!-- Personal Info -->
        <div class="info-card">
            <div class="info-header">
                <div class="info-icon blue"><img src="{{ url_for('static', filename='img/icons/person.svg') }}" alt="" width="24" height="24"></div>
                <div class="info-title">
                    <h3>Datos Personales</h3>
                    <p>Información básica de tu cuenta</p>
                </div>
            </div>

            <form action="{{ url_for('update_perfil') }}" method="POST">
                <div class="info-grid">
                    <div class="form-group full">
                        <label for="nombreCompleto">Nombre Completo</label>
                        <input type="text" id="nombreCompleto" name="nombre_completo"
                            value="{% if session.user %}{{ session.user.nombre_completo }}{% endif %}" required>
                    </div>
                    <div class="form-group">
                        <label for="tipoDocumento">Tipo Documento</label>
                        <input type="text" id="tipoDocumento"
                            value="{% if session.user %}{{ session.user.tipo_documento }}{% endif %}" disabled>
                    </div>
                    <div class="form-group">
                        <label for="numeroDocumento">Número Documento</label>
                        <input type="text" id="numeroDocumento"
                            value="{% if session.user %}{{ session.user.numero_documento }}{% endif %}" disabled>
                    </div>
                </div>

                <div class="form-actions">
                    <a href="{{ url_for('perfil') }}" class="btn btn-secondary">Cancelar</a>
                    <button type="submit" class="btn btn-primary">
                        <img src="{{ url_for('static', filename='img/icons/save.svg') }}" alt="" width="18" height="18" class="icon">
                        Guardar Cambios
                    </button>
                </div>
            </form>
        </div>

        <!-- Contact Info -->
        <div class="info-card">
            <div class="info-header">
                <div class="info-icon purple"><img src="{{ url_for('static', filename='img/icons/email.svg') }}" alt="" width="24" height="24"></div>
                <div class="info-title">
                    <h3>Información de Contacto</h3>
                    <p>Correo y datos de acceso</p>
                </div>
            </div>

            <div class="info-grid">
                <div class="form-group full">
                    <label for="correo">Correo Electrónico</label>
                    <input type="email" id="correo" value="{% if session.user %}{{ session.user.correo }}{% endif %}"
                        disabled>
                    <small style="color: #64748b; margin-top: 0.5rem; display: block;">
                        El correo electrónico no puede ser modificado por seguridad.
                    </small>
                </div>
            </div>
        </div>

        <!-- Security -->
        <div class="info-card">
            <div class="info-header">
                <div class="info-icon teal"><img src="{{ url_for('static', filename='img/icons/lock.svg') }}" alt="" width="24" height="24"></div>
                <div class="info-title">
                    <h3>Seguridad</h3>
                    <p>Gestión de contraseña</p>
                </div>
            </div>

            <form action="{{ url_for('update_password') }}" method="POST">
                <div class="info-grid">
                    <div class="form-group">
                        <label for="currentPassword">Contraseña Actual</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="currentPassword" name="current_password" placeholder="••••••••"
                                required>
                            <button type="button" class="password-toggle" data-target="currentPassword">
                                <img src="{{ url_for('static', filename='img/icons/visibility.svg') }}" alt="" width="20" height="20">
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">Nueva Contraseña</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="newPassword" name="new_password" placeholder="••••••••" required
                                minlength="6">
                            <button type="button" class="password-toggle" data-target="newPassword">
                                <img src="{{ url_for('static', filename='img/icons/visibility.svg') }}" alt="" width="20" height="20">
                            </button>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <img src="{{ url_for('static', filename='img/icons/key.svg') }}" alt="" width="18" height="18" class="icon">
                        Cambiar Contraseña
                    </button>
                </div>
            </form>
        </div>
    </div>

</div>
{% endblock %}