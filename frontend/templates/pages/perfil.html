{% extends 'base_admin.html' %}

{% block title %}Mi Perfil - Sign Technology{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/perfil.css') }}">
{% endblock %}

{% block content %}
<div class="profile-container">

    <!-- Profile Card -->
    <div class="profile-card">
        <form action="{{ url_for('update_avatar') }}" method="POST" enctype="multipart/form-data" id="avatarForm">
            <label class="profile-avatar-wrapper" for="avatarInput" title="Haga clic para cambiar foto"
                style="cursor: pointer;">
                <div class="profile-avatar">
                    {% set avatar_img = session.user.imagen_perfil if session.user and session.user.imagen_perfil and session.user.imagen_perfil|length > 0 else 'user.svg' %}
                    <img src="{{ url_for('static', filename='img/profiles/' + avatar_img) }}?t={{ range(1000, 99999)|random }}"
                        alt="Avatar"
                        onerror="this.src='{{ url_for('static', filename='img/profiles/user.svg') }}'">
                </div>
                <div class="avatar-edit">
                    <span class="material-icons">camera_alt</span>
                </div>
                <input type="file" id="avatarInput" name="avatar" accept="image/*" hidden>
            </label>
        </form>

        <h2 class="profile-name">
            {% if session.user %}{{ session.user.nombre_completo }}{% else %}Usuario{% endif %}
        </h2>

        <div class="profile-role">
            <span class="role-badge-highlight">
                {% if session.user %}{{ session.user.nombre_rol or 'Colaborador' }}{% else %}Colaborador{% endif %}
            </span>
        </div>

        <div class="profile-stats">
            <div class="profile-stat">
                <label>Miembro desde</label>
                <span>
                    {% if session.user %}
                    {{ session.user.fecha_registro[:7] if session.user.fecha_registro else 'Enero 2026' }}
                    {% else %}
                    Enero 2026
                    {% endif %}
                </span>
            </div>
        </div>
    </div>

    <!-- Info Section -->
    <div class="info-section">
        <!-- Personal Info -->
        <div class="info-card">
            <div class="info-header">
                <div class="info-icon blue"><span class="material-icons">person</span></div>
                <div class="info-title">
                    <h3>Datos Personales</h3>
                    <p>Información básica de tu cuenta</p>
                </div>
            </div>

            <form action="{{ url_for('update_perfil') }}" method="POST">
                <div class="info-grid">
                    <div class="form-group full">
                        <label for="nombreCompleto">Nombre Completo</label>
                        <input type="text" id="nombreCompleto" name="nombre_completo"
                            value="{% if session.user %}{{ session.user.nombre_completo }}{% endif %}" required>
                    </div>
                    <div class="form-group">
                        <label for="tipoDocumento">Tipo Documento</label>
                        <input type="text" id="tipoDocumento"
                            value="{% if session.user %}{{ session.user.tipo_documento }}{% endif %}" disabled>
                    </div>
                    <div class="form-group">
                        <label for="numeroDocumento">Número Documento</label>
                        <input type="text" id="numeroDocumento"
                            value="{% if session.user %}{{ session.user.numero_documento }}{% endif %}" disabled>
                    </div>
                </div>

                <div class="form-actions">
                    <a href="{{ url_for('perfil') }}" class="btn btn-secondary">Cancelar</a>
                    <button type="submit" class="btn btn-primary">
                        <span class="material-icons" style="font-size: 18px;">save</span>
                        Guardar Cambios
                    </button>
                </div>
            </form>
        </div>

        <!-- Contact Info -->
        <div class="info-card">
            <div class="info-header">
                <div class="info-icon purple"><span class="material-icons">mail</span></div>
                <div class="info-title">
                    <h3>Información de Contacto</h3>
                    <p>Correo y datos de acceso</p>
                </div>
            </div>

            <div class="info-grid">
                <div class="form-group full">
                    <label for="correo">Correo Electrónico</label>
                    <input type="email" id="correo" value="{% if session.user %}{{ session.user.correo }}{% endif %}"
                        disabled>
                    <small style="color: #64748b; margin-top: 0.5rem; display: block;">
                        El correo electrónico no puede ser modificado por seguridad.
                    </small>
                </div>
            </div>
        </div>

        <!-- Security -->
        <div class="info-card">
            <div class="info-header">
                <div class="info-icon teal"><span class="material-icons">lock</span></div>
                <div class="info-title">
                    <h3>Seguridad</h3>
                    <p>Gestión de contraseña</p>
                </div>
            </div>

            <form action="{{ url_for('update_password') }}" method="POST">
                <div class="info-grid">
                    <div class="form-group">
                        <label for="currentPassword">Contraseña Actual</label>
                        <input type="password" id="currentPassword" name="current_password" placeholder="••••••••"
                            required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">Nueva Contraseña</label>
                        <input type="password" id="newPassword" name="new_password" placeholder="••••••••" required
                            minlength="6">
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <span class="material-icons" style="font-size: 18px;">key</span>
                        Cambiar Contraseña
                    </button>
                </div>
            </form>
        </div>
    </div>

</div>
{% endblock %}